#!/usr/bin/env bash

BASE="$(cd $(dirname $BASH_SOURCE); pwd)"
SOURCE="$BASE/src"
BUILD="$BASE/build"
RELEASE="$BASE/release"

cmake-init() { (
    set -e
    mkdir -p "$BUILD"
    cd "$BUILD"

    WARNING_FLAGS="-Wno-cast-align \
         -Wno-mismatched-tags -Wunused-parameter \
         -Wno-inconsistent-missing-override"
    cmake "$SOURCE" -G Ninja                                           \
         -DCMAKE_C_COMPILER_LAUNCHER=ccache                            \
         -DCMAKE_C_COMPILER=clang                                      \
         -DCMAKE_C_FLAGS=-fcolor-diagnostics                           \
         -DCMAKE_CXX_COMPILER_LAUNCHER=ccache                          \
         -DCMAKE_CXX_COMPILER=clang++                                  \
        "-DCMAKE_CXX_FLAGS=-fcolor-diagnostics $WARNING_FLAGS"         \
         -DCMAKE_BUILD_TYPE=RelWithDebInfo                             \
         -DBUILD_TESTING=ON                                            \
         -DCMAKE_INSTALL_PREFIX="${RELEASE}"
) }

build-target() {
    echo -e '\n\n\n\n'
    (cd "$BUILD"; ninja $*)
}
build() { build-target install; }
run() { "$RELEASE/bin/krita" $*; }

docs() { (
    mkdir -p "$BASE/doc"
    cd "$BASE/doc"
    kapidox_generate "$SOURCE"
) }
